---
import { getCollection } from "astro:content";
import Page from "@layouts/Page.astro";

const posts = (await getCollection("blog")).sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf(),
);

const dateString = (d) => {
  return d.getDate() + " " + d.toLocaleString("default", { month: "long" }) + " " + d.getFullYear();
};
---

<Page title="Blog">
    <h4 class='text-muted'>Blogging about Nextflow, computational workflows, containers and cloud computing</h4>
    <hr>
    <div class="row">
        <div class="col-sm-8">
          <div class="timeline">
    {
        posts.map((post) => {
          return (
            <section class="blg-summary">
                <h3 ><a href={"/blog/" + post.slug}>{post.data.title}</a></h3>
                <div class="timeline-info hidden-xs">
                  <img src={"/img/"+post.data.icon} class="blg-author" alt={post.data.author}>
                </div>
                <ul class="text-muted list-inline blg-header">
                  <li><i class="fa fa-user"></i> {post.data.author}</li>
                  <li><i class="fa fa-calendar"></i> {dateString(post.data.date)} </li>
                </ul>
                <hr>
                <p class="blg-text">
                  {async () => {
                      const { remarkPluginFrontmatter } = await post.render();
                      return remarkPluginFrontmatter.excerpt;
                  }}
                </p>
            </section>
          );
        })
      }
</Page>
