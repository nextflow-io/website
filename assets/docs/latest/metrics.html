<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Metrics &mdash; Nextflow 23.10.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Pipeline sharing" href="sharing.html" />
    <link rel="prev" title="Tracing &amp; visualisation" href="tracing.html" />
     
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TNCXSWG');</script>
    <!-- End Google Tag Manager -->

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/nextflow-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
    <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">Basic concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Language</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="script.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl1.html">Migrating from DSL 1</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Execution</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="cache-and-resume.html">Caching and resuming</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing &amp; visualisation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Metrics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cpu-usage">CPU Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory-usage">Memory Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-duration">Job Duration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i-o-usage">I/O Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">Pipeline sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Workflow introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">Mail &amp; Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="secrets.html">Secrets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software dependencies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="container.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Conda environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="spack.html">Spack environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="wave.html">Wave containers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Compute &amp; storage platforms</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="aws.html">Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="amazons3.html">Amazon S3 storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure.html">Azure Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="fusion.html">Fusion file system</a></li>
<li class="toctree-l1"><a class="reference internal" href="google.html">Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional integrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="flux.html">Flux Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="ignite.html">Apache Ignite</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="developer/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/packages.html">Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/plugins.html">Core plugins</a></li>
</ul>

        </div>
    <div class="nav-footer-logo">
        <a href="https://seqera.io/" target="_blank" title="Developed by Seqera Labs">
            Nextflow is developed by:<br>
            <img src="_static/seqera-logo.svg" alt="Seqera Labs">
        </a>
    </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nextflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Metrics</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/nextflow-io/nextflow/blob/master/docs/metrics.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="metrics">
<span id="metrics-page"></span><h1>Metrics<a class="headerlink" href="#metrics" title="Permalink to this heading"></a></h1>
<p>This section details how the resource usage metrics from the <a class="reference internal" href="tracing.html#execution-report"><span class="std std-ref">Execution report</span></a> are computed.</p>
<section id="cpu-usage">
<h2>CPU Usage<a class="headerlink" href="#cpu-usage" title="Permalink to this heading"></a></h2>
<p>The plot reports how much CPU resources were used by each process.</p>
<img alt="_images/report-resource-cpu.png" src="_images/report-resource-cpu.png" />
<p>Let’s illustrate how this plot behaves with several examples.</p>
<p>In the first example, let’s consider the simple use case in which a process performs one task of pure computation using one CPU. Then, you expect the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tab to report 100%. If the task is distributed over, 2, 3, 4, <code class="docutils literal notranslate"><span class="pre">etc.</span></code> CPUs, then the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> will be 200%, 300%, 400%, <code class="docutils literal notranslate"><span class="pre">etc.</span></code> respectively. The <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">Allocated</span></code> tab just rescales the raw value usage with respect to the number of CPUs set with the <code class="docutils literal notranslate"><span class="pre">cpus</span></code> directive (if not set with the directive, the number of CPUs is set to 1, thus showing the same values as in the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tab). Using the program <a class="reference external" href="https://people.seas.harvard.edu/~apw/stress/">stress</a> as follows would report 100% in the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tab and 50% in the <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">Allocated</span></code> tab since the process asked twice the number of CPUs needed by the process:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env nextflow</span>

<span class="n">process</span><span class="w"> </span><span class="n">CpuUsageEx1</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="n">cpus</span><span class="w"> </span><span class="mi">2</span>

<span class="w">  </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  stress -c 1 -t 10 # compute square-root of random numbers during 10s using 1 CPU</span>
<span class="s2">  &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In the second example, some time will be spent performing pure computation and some time just waiting. Using the program <a class="reference external" href="https://people.seas.harvard.edu/~apw/stress/">stress</a> and <code class="docutils literal notranslate"><span class="pre">sleep</span></code> as follows would report 75% in the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tab:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env nextflow</span>

<span class="n">process</span><span class="w"> </span><span class="n">CpuUsageEx2</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="n">cpus</span><span class="w"> </span><span class="mi">1</span>

<span class="w">  </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  stress -c 1 -t 10 # compute square-root of random numbers during 10s using 1 CPU</span>
<span class="s2">  stress -c 1 -t 5 # compute square-root of random numbers during 5s using 1 CPU</span>
<span class="s2">  sleep 5 # use no CPU during 5s</span>
<span class="s2">  &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Indeed, the percentage of the CPU that this process got is a weighted average taking into account the percentage of the CPU and duration of each individual program over the job duration (a.k.a. elapsed real time, real time or wall time ) as follows:</p>
<div class="math notranslate nohighlight">
\[
\frac{ 100\% \times 10s + 100\% \times 5s + 0\% \times 5s }{10s+5s+5s} = 75\%
\]</div>
<p>The third example is similar to the second one except that the pure computation stage is performed in a single step forked on 2 CPUs:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env nextflow</span>

<span class="n">process</span><span class="w"> </span><span class="n">CpuUsageEx3</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="n">cpus</span><span class="w"> </span><span class="mi">2</span>

<span class="w">  </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  stress -c 2 -t 10 # compute square-root of random numbers during 10s using 2 CPUs</span>
<span class="s2">  sleep 10 # use no CPU during 10s</span>
<span class="s2">  &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tab would report 100% in the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tab:</p>
<div class="math notranslate nohighlight">
\[
\frac{ 200\% \times 10s }{10s+10s} = 100\%
\]</div>
<p>The <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">Allocated</span></code> tab would report 50%, however, it would not be relevant to change the <code class="docutils literal notranslate"><span class="pre">cpus</span></code> directive from 2 to 1 as the process really uses 2 CPUs at it peak load.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a class="reference external" href="https://people.seas.harvard.edu/~apw/stress/">stress</a> program can be installed with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">stress</span></code> or <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">yum</span> <span class="pre">install</span> <span class="pre">stress</span></code> depending on your Linux distribution.</p>
</div>
</section>
<section id="memory-usage">
<h2>Memory Usage<a class="headerlink" href="#memory-usage" title="Permalink to this heading"></a></h2>
<p>The plot has three tabs showing the usage of the physical memory (RAM), the virtual memory (vmem) and the percentage of RAM used by the process with respect to what was set in the <code class="docutils literal notranslate"><span class="pre">memory</span></code> directive. The peak usage during the execution of the process is reported for both physical and virtual memories.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To better understand the memory usage plot, it is important to know that:</p>
<ul class="simple">
<li><p>the total amount of memory used by a process is the <code class="docutils literal notranslate"><span class="pre">virtual</span> <span class="pre">memory</span> <span class="pre">(vmem)</span></code>. The <code class="docutils literal notranslate"><span class="pre">vmem</span></code> contains all memory areas whether they are in the physical memory (RAM), in the Swap space, on the disk or shared with other processes,</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">resident</span> <span class="pre">set</span> <span class="pre">size</span> <span class="pre">(RSS)</span></code> is the amount of space of <code class="docutils literal notranslate"><span class="pre">physical</span> <span class="pre">memory</span> <span class="pre">(RAM)</span></code> held by a process,</p></li>
<li><p>the relationship is: vmem <span class="math notranslate nohighlight">\(\geq\)</span> RSS + Swap,</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">memory</span></code> directive sets the RAM requested by the process.</p></li>
</ul>
</div>
<p>Let’s illustrate how this plot behaves with one example which relies on two C programs.</p>
<p>The first program just allocates a variable of 1 GiB:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/resource.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/time.h&gt;</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="linenos"> 6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos"> 7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="cm">/* Get vmem and rss usage from /proc/&lt;pid&gt;/statm */</span>
<span class="linenos">10</span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">mem_used</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="o">*</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="o">*</span><span class="w"> </span><span class="n">rss</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">path</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
<span class="linenos">13</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page_size</span><span class="p">;</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/proc/%ld/statm&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">    </span><span class="c1">// vmem and rss are the first values in the file</span>
<span class="linenos">18</span><span class="w">    </span><span class="n">fscanf</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lu %lu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">    </span><span class="c1">// values in statm are in pages so to get bytes we need to know page size</span>
<span class="linenos">20</span><span class="w">    </span><span class="n">page_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="n">getpagesize</span><span class="p">();</span>
<span class="linenos">21</span><span class="w">    </span><span class="o">*</span><span class="n">vmem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">vmem</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">page_size</span><span class="p">;</span>
<span class="linenos">22</span><span class="w">    </span><span class="o">*</span><span class="n">rss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">rss</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">page_size</span><span class="p">;</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">26</span><span class="p">}</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">29</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">address</span><span class="p">;</span>
<span class="linenos">30</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">input</span><span class="p">;</span>
<span class="hll"><span class="linenos">31</span><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">;</span><span class="w">  </span><span class="c1">// 1 GiB</span>
</span><span class="linenos">32</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">vmem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">34</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">rss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">35</span><span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="w">    </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getpid</span><span class="p">();</span>
<span class="linenos">38</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Pid: %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="w">    </span><span class="n">mem_used</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">41</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;VMEM: %lu RSS: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">42</span>
<span class="hll"><span class="linenos">43</span><span class="w">    </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span><span class="linenos">44</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allocated %d Bytes of memory</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">    </span><span class="n">mem_used</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">47</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;VMEM: %lu RSS: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">48</span>
<span class="linenos">49</span><span class="w">    </span><span class="c1">// Leave time for nextflow to get information</span>
<span class="linenos">50</span><span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
<span class="linenos">51</span>
<span class="linenos">52</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
<span class="linenos">53</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">54</span><span class="p">}</span>
</pre></div>
</div>
<p>The second program allocates a variable of 1 GiB and fills it with data:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/resource.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/time.h&gt;</span>
<span class="linenos"> 5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="linenos"> 6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="linenos"> 7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="cm">/* Get vmem and rss usage from /proc/&lt;pid&gt;/statm */</span>
<span class="linenos">10</span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">mem_used</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="o">*</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="o">*</span><span class="w"> </span><span class="n">rss</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">path</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
<span class="linenos">13</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">page_size</span><span class="p">;</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="w">    </span><span class="n">snprintf</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/proc/%ld/statm&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
<span class="linenos">16</span><span class="w">    </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">);</span>
<span class="linenos">17</span><span class="w">    </span><span class="c1">// vmem and rss are the first values in the file</span>
<span class="linenos">18</span><span class="w">    </span><span class="n">fscanf</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lu %lu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">    </span><span class="c1">// values in statm are in pages so to get bytes we need to know page size</span>
<span class="linenos">20</span><span class="w">    </span><span class="n">page_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="n">getpagesize</span><span class="p">();</span>
<span class="linenos">21</span><span class="w">    </span><span class="o">*</span><span class="n">vmem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">vmem</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">page_size</span><span class="p">;</span>
<span class="linenos">22</span><span class="w">    </span><span class="o">*</span><span class="n">rss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">rss</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">page_size</span><span class="p">;</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">26</span><span class="p">}</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">29</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">address</span><span class="p">;</span>
<span class="linenos">30</span><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">input</span><span class="p">;</span>
<span class="hll"><span class="linenos">31</span><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">;</span><span class="w">  </span><span class="c1">// 1 GiB</span>
</span><span class="linenos">32</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">vmem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">34</span><span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">rss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">35</span><span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="linenos">36</span>
<span class="linenos">37</span><span class="w">    </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getpid</span><span class="p">();</span>
<span class="linenos">38</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Pid: %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="w">    </span><span class="n">mem_used</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">41</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;VMEM: %lu RSS: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">42</span>
<span class="hll"><span class="linenos">43</span><span class="w">    </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span><span class="linenos">44</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Allocated %d Bytes of memory</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">    </span><span class="n">mem_used</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">47</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;VMEM: %lu RSS: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">48</span>
<span class="hll"><span class="linenos">49</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Filling memory with data...&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">50</span><span class="w">    </span><span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
</span><span class="hll"><span class="linenos">51</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos">52</span><span class="w">        </span><span class="o">*</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">53</span><span class="w">    </span><span class="p">}</span>
</span><span class="linenos">54</span>
<span class="linenos">55</span><span class="w">    </span><span class="n">mem_used</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">56</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">VMEM: %lu RSS: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">vmem</span><span class="p">,</span><span class="w"> </span><span class="n">rss</span><span class="p">);</span>
<span class="linenos">57</span>
<span class="linenos">58</span><span class="w">    </span><span class="c1">// Leave time for nextflow to get information</span>
<span class="linenos">59</span><span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
<span class="linenos">60</span>
<span class="linenos">61</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
<span class="linenos">62</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">63</span><span class="p">}</span>
</pre></div>
</div>
<p>The first and second programs are executed in <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> processes respectively as follows:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env nextflow</span>

<span class="n">process</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="s1">&#39;1.5 GB&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    memory_vmem_1GiB_ram_0Gib</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>

<span class="n">process</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="s1">&#39;1.5 GB&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    memory_vmem_1GiB_ram_1Gib</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">(RAM</span> <span class="pre">+</span> <span class="pre">Disk</span> <span class="pre">swap)</span></code> tab shows that both <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code> processes use the same amount of virtual memory (~1 GiB):</p>
<img alt="_images/report-resource-memory-vmem.png" src="_images/report-resource-memory-vmem.png" />
<p>However, the <code class="docutils literal notranslate"><span class="pre">Physical</span> <span class="pre">(RAM)</span></code> tab shows that only the <code class="docutils literal notranslate"><span class="pre">bar</span></code> process uses ~1 GiB of RAM while <code class="docutils literal notranslate"><span class="pre">foo</span></code> process uses ~0 GiB:</p>
<img alt="_images/report-resource-memory-ram.png" src="_images/report-resource-memory-ram.png" />
<p>As expected, the <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">RAM</span> <span class="pre">Allocated</span></code> tab shows that 0% of the resource set in the <code class="docutils literal notranslate"><span class="pre">memory</span></code> directive was used for <code class="docutils literal notranslate"><span class="pre">foo</span></code> process while 67% (= 1 / 1.5) of the resource were used for <code class="docutils literal notranslate"><span class="pre">bar</span></code> process:</p>
<img alt="_images/report-resource-memory-pctram.png" src="_images/report-resource-memory-pctram.png" />
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Memory and storage metrics are reported in bytes. This means that 1KB = <span class="math notranslate nohighlight">\(1024\)</span> bytes, 1 MB = <span class="math notranslate nohighlight">\(1024^2\)</span> bytes, 1 GB = <span class="math notranslate nohighlight">\(1024^3\)</span> bytes, etc.</p>
</div>
</section>
<section id="job-duration">
<h2>Job Duration<a class="headerlink" href="#job-duration" title="Permalink to this heading"></a></h2>
<p>The plot has two tabs the job duration (a.k.a. elapsed real time, real time or wall time ) in the <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Usage</span></code> tag and the percentage of requested time used in the <code class="docutils literal notranslate"><span class="pre">%</span> <span class="pre">Allocated</span></code> tab with respect to the duration set in the <code class="docutils literal notranslate"><span class="pre">time</span></code> directive of the process.</p>
<img alt="_images/report-resource-job-duration.png" src="_images/report-resource-job-duration.png" />
</section>
<section id="i-o-usage">
<h2>I/O Usage<a class="headerlink" href="#i-o-usage" title="Permalink to this heading"></a></h2>
<p>The plot has two tabs showing how many data were read and/or written each process. For example, the following processes read and write 1GB and 256MB of data respectively:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env nextflow</span>

<span class="n">process</span><span class="w"> </span><span class="n">io_read_write_1G</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  dd if=/dev/zero of=/dev/null bs=1G count=1</span>
<span class="s2">  &quot;&quot;&quot;</span>
<span class="o">}</span>

<span class="n">process</span><span class="w"> </span><span class="n">io_read_write_256M</span><span class="w"> </span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">  dd if=/dev/zero of=/dev/null bs=256M count=1</span>
<span class="s2">  &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Read</span></code> tab:</p>
<img alt="_images/report-resource-io-read.png" src="_images/report-resource-io-read.png" />
<p><code class="docutils literal notranslate"><span class="pre">Write</span></code> tab:</p>
<img alt="_images/report-resource-io-write.png" src="_images/report-resource-io-write.png" />
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tracing.html" class="btn btn-neutral float-left" title="Tracing &amp; visualisation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sharing.html" class="btn btn-neutral float-right" title="Pipeline sharing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Seqera Labs, S.L.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
     
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TNCXSWG"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->


</body>
</html>