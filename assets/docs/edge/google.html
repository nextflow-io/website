<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Cloud &mdash; Nextflow 23.07.0-edge documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Apache Ignite" href="ignite.html" />
    <link rel="prev" title="Flux Framework" href="flux.html" />
     
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TNCXSWG');</script>
    <!-- End Google Tag Manager -->

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/nextflow-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
    <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="script.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl2.html">DSL 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Conda environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="spack.html">Spack environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="wave.html">Wave containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="fusion.html">Fusion file system</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws.html">Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="amazons3.html">Amazon S3 storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure.html">Azure Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="flux.html">Flux Framework</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Google Cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#credentials">Credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-batch">Cloud Batch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-definition">Process definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipeline-execution">Pipeline execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#spot-instances">Spot instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fusion-file-system">Fusion file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="#supported-directives">Supported directives</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cloud-life-sciences">Cloud Life Sciences</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#google-lifesciences-config">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Process definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Pipeline execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preemptible-instances">Preemptible instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hybrid-execution">Hybrid execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ignite.html">Apache Ignite</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing &amp; visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">Pipeline sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Workflow introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">Mail &amp; Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="secrets.html">Secrets</a></li>
</ul>

        </div>
    <div class="nav-footer-logo">
        <a href="https://seqera.io/" target="_blank" title="Developed by Seqera Labs">
            Nextflow is developed by:<br>
            <img src="_static/seqera-logo.png" alt="Seqera Labs">
        </a>
    </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nextflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Google Cloud</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/nextflow-io/nextflow/blob/master/docs/google.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="google-cloud">
<span id="google-page"></span><h1>Google Cloud<a class="headerlink" href="#google-cloud" title="Permalink to this heading"></a></h1>
<section id="credentials">
<h2>Credentials<a class="headerlink" href="#credentials" title="Permalink to this heading"></a></h2>
<p>Credentials for submitting requests to the Google Cloud Batch and Cloud LifeSciences API are picked up from your environment using <a class="reference external" href="https://github.com/googleapis/google-auth-library-java#google-auth-library-oauth2-http">Application Default Credentials</a>. Application Default Credentials are designed to use the credentials most natural to the environment in which a tool runs.</p>
<p>The most common case will be to pick up your end-user Google credentials from your workstation. You can create these by running the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud<span class="w"> </span>auth<span class="w"> </span>application-default<span class="w"> </span>login
</pre></div>
</div>
<p>and running through the authentication flow. This will write a credential file to your gcloud configuration directory that will be used for any tool you run on your workstation that picks up default credentials.</p>
<p>The next most common case would be when running on a Compute Engine VM. In this case, Application Default Credentials will pick up the Compute Engine Service Account credentials for that VM.</p>
<p>See the <a class="reference external" href="https://github.com/googleapis/google-auth-library-java#google-auth-library-oauth2-http">Application Default Credentials</a> documentation for how to enable other use cases.</p>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">GOOGLE_APPLICATION_CREDENTIALS</span></code> environment variable can be used to specify location of the Google credentials file.</p>
<p>If you don’t have it, the credentials file can be downloaded from the Google Cloud Console following these steps:</p>
<ul class="simple">
<li><p>Open the <a class="reference external" href="https://console.cloud.google.com">Google Cloud Console</a></p></li>
<li><p>Go to APIs &amp; Services → Credentials</p></li>
<li><p>Click on the <em>Create credentials</em> (blue) drop-down and choose <em>Service account key</em>, in the following page</p></li>
<li><p>Select an existing <em>Service account</em> or create a new one if needed</p></li>
<li><p>Select JSON as <em>Key type</em></p></li>
<li><p>Click the <em>Create</em> button and download the JSON file giving a name of your choice e.g. <code class="docutils literal notranslate"><span class="pre">creds.json</span></code>.</p></li>
</ul>
<p>Then, define the following variable replacing the path in the example with the one of your credentials file just downloaded:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">GOOGLE_APPLICATION_CREDENTIALS</span><span class="o">=</span><span class="s2">&quot;/path/your/file/creds.json&quot;</span>
</pre></div>
</div>
</section>
<section id="cloud-batch">
<span id="google-batch"></span><h2>Cloud Batch<a class="headerlink" href="#cloud-batch" title="Permalink to this heading"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 22.07.1-edge.</span></p>
</div>
<p><a class="reference external" href="https://cloud.google.com/batch">Google Cloud Batch</a> is a managed computing service that allows the execution of containerized workloads in the Google Cloud Platform infrastructure.</p>
<p>Nextflow provides built-in support for Google Cloud Batch, allowing the seamless deployment of Nextflow pipelines in the cloud, in which tasks are offloaded to the Cloud Batch service.</p>
<p>Read the <a class="reference internal" href="executor.html#google-batch-executor"><span class="std std-ref">Google Cloud Batch executor</span></a> section to learn more about the <code class="docutils literal notranslate"><span class="pre">google-batch</span></code> executor in Nextflow.</p>
<section id="configuration">
<span id="google-batch-config"></span><h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h3>
<p>Make sure to have defined in your environment the <code class="docutils literal notranslate"><span class="pre">GOOGLE_APPLICATION_CREDENTIALS</span></code> variable. See the <a class="reference internal" href="#credentials"><span class="std std-doc">Credentials</span></a> section for details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure your Google account is allowed to access the Google Cloud Batch service by checking the <a class="reference external" href="https://console.cloud.google.com/apis/dashboard">APIs &amp; Services</a> dashboard.</p>
</div>
<p>Create or edit the file <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> in your project root directory. The config must specify the following parameters:</p>
<ul class="simple">
<li><p>Google Cloud Batch as Nextflow executor</p></li>
<li><p>The Docker container image(s) for pipeline tasks</p></li>
<li><p>The Google Cloud project ID and location</p></li>
</ul>
<p>Example:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;google-batch&#39;</span>
<span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;your/container:latest&#39;</span>
<span class="o">}</span>

<span class="n">google</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">project</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;your-project-id&#39;</span>
<span class="w">    </span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;us-central1&#39;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>A container image must be specified to execute processes. You can use a different Docker image for each process using one or more <a class="reference internal" href="config.html#config-process-selectors"><span class="std std-ref">Process selectors</span></a>.</p></li>
<li><p>Make sure to specify the project ID, not the project name.</p></li>
<li><p>Make sure to specify a location where Google Batch is available. Refer to the <a class="reference external" href="https://cloud.google.com/batch/docs/get-started#locations">Google Batch documentation</a> for region availability.</p></li>
</ul>
<p>Read the <a class="reference internal" href="config.html#config-google"><span class="std std-ref">Google configuration</span></a> section to learn more about advanced configuration options.</p>
</section>
<section id="process-definition">
<span id="google-batch-process"></span><h3>Process definition<a class="headerlink" href="#process-definition" title="Permalink to this heading"></a></h3>
<p>Processes can be defined as usual and by default the <code class="docutils literal notranslate"><span class="pre">cpus</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code> directives are used to find the cheapest machine type available at current location that fits the requested resources. If <code class="docutils literal notranslate"><span class="pre">memory</span></code> is not specified, 1GB of memory is allocated per cpu.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 23.02.0-edge: </span>The <code class="docutils literal notranslate"><span class="pre">machineType</span></code> directive can be a list of patterns separated by comma. The pattern can contain a <code class="docutils literal notranslate"><span class="pre">*</span></code> to match any number of characters and <code class="docutils literal notranslate"><span class="pre">?</span></code> to match any single character. Examples of valid patterns: <code class="docutils literal notranslate"><span class="pre">c2-*</span></code>, <code class="docutils literal notranslate"><span class="pre">m?-standard*</span></code>, <code class="docutils literal notranslate"><span class="pre">n*</span></code>.</p>
<p>Alternatively it can also be used to define a specific predefined Google Compute Platform <a class="reference external" href="https://cloud.google.com/compute/docs/machine-types">machine type</a> or a custom machine type.</p>
</div>
<p>Examples:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="n">automatic_resources_task</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="s1">&#39;40 GB&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;Your script here&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>

<span class="n">process</span><span class="w"> </span><span class="n">allowing_some_series</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="s1">&#39;20 GB&#39;</span>
<span class="w">    </span><span class="n">machineType</span><span class="w"> </span><span class="s1">&#39;n2-*,c2-*,m3-*&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;Your script here&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>

<span class="n">process</span><span class="w"> </span><span class="n">predefined_resources_task</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">machineType</span><span class="w"> </span><span class="s1">&#39;n1-highmem-8&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;Your script here&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 23.06.0-edge.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">disk</span></code> directive can be used to set the boot disk size or provision a disk for scratch storage. If the disk type is specified with the <code class="docutils literal notranslate"><span class="pre">type</span></code> option, a new disk will be mounted to the task VM at <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> with the requested size and type. Otherwise, it will set the boot disk size, overriding the <code class="docutils literal notranslate"><span class="pre">google.batch.bootDiskSize</span></code> config option. See the <a class="reference external" href="https://cloud.google.com/compute/docs/disks">Google Batch documentation</a> for more information about the available disk types.</p>
<p>Examples:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="c1">// set the boot disk size</span>
<span class="n">disk</span><span class="w"> </span><span class="mi">100</span><span class="o">.</span><span class="na">GB</span>

<span class="c1">// mount a persistent disk at &#39;/tmp&#39;</span>
<span class="n">disk</span><span class="w"> </span><span class="mi">100</span><span class="o">.</span><span class="na">GB</span><span class="o">,</span><span class="w"> </span><span class="nl">type:</span><span class="w"> </span><span class="s1">&#39;pd-standard&#39;</span>

<span class="c1">// mount a local SSD disk at &#39;/tmp&#39; (should be a multiple of 375 GB)</span>
<span class="n">disk</span><span class="w"> </span><span class="mi">375</span><span class="o">.</span><span class="na">GB</span><span class="o">,</span><span class="w"> </span><span class="nl">type:</span><span class="w"> </span><span class="s1">&#39;local-ssd&#39;</span>
</pre></div>
</div>
</section>
<section id="pipeline-execution">
<h3>Pipeline execution<a class="headerlink" href="#pipeline-execution" title="Permalink to this heading"></a></h3>
<p>The pipeline can be launched either in a local computer or a cloud instance. Pipeline input data can be stored either locally or in a Google Storage bucket.</p>
<p>The pipeline execution must specify a Google Storage bucket where the workflow’s intermediate results are stored using the <code class="docutils literal notranslate"><span class="pre">-work-dir</span></code> command line options. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nextflow<span class="w"> </span>run<span class="w"> </span>&lt;script<span class="w"> </span>or<span class="w"> </span>project<span class="w"> </span>name&gt;<span class="w"> </span>-work-dir<span class="w"> </span>gs://my-bucket/some/path
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Any input data <strong>not</strong> stored in a Google Storage bucket will automatically be transferred to the pipeline work bucket. Use this feature with caution being careful to avoid unnecessary data transfers.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Google Storage path needs to contain at least sub-directory. Don’t use only the bucket name e.g. <code class="docutils literal notranslate"><span class="pre">gs://my-bucket</span></code>.</p>
</div>
</section>
<section id="spot-instances">
<h3>Spot instances<a class="headerlink" href="#spot-instances" title="Permalink to this heading"></a></h3>
<p>Spot instances are supported adding the following setting in the Nextflow config file:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">google</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">batch</span><span class="o">.</span><span class="na">spot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Since this type of virtual machines can be retired by the provider before the job completion, it is advisable to add the following retry strategy to your config file to instruct Nextflow to automatically re-execute a job if the virtual machine was terminated preemptively:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">task</span><span class="o">.</span><span class="na">exitStatus</span><span class="o">==</span><span class="mi">14</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;retry&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;terminate&#39;</span><span class="w"> </span><span class="o">}</span>
<span class="w">    </span><span class="n">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="fusion-file-system">
<h3>Fusion file system<a class="headerlink" href="#fusion-file-system" title="Permalink to this heading"></a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 23.02.0-edge.</span></p>
</div>
<p>The Google Batch executor supports the use of <a class="reference internal" href="fusion.html#fusion-page"><span class="std std-ref">Fusion file system</span></a>. Fusion allows the use of Google Cloud Storage as a virtual distributed file system, optimising the data transfer and speeding up most job I/O operations.</p>
<p>To enable the use of Fusion file system in your pipeline, add the following snippet to your Nextflow configuration file:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">fusion</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">wave</span><span class="o">.</span><span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">process</span><span class="o">.</span><span class="na">scratch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="n">tower</span><span class="o">.</span><span class="na">accessToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&lt;YOUR ACCESS TOKEN&gt;&#39;</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://cloud.tower.nf">Tower</a> access token is optional, but it enables higher API rate limits for the <a class="reference internal" href="wave.html#wave-page"><span class="std std-ref">Wave containers</span></a> service required by Fusion.</p>
<p>By default, Fusion mounts a local SSD disk to the VM at <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>, using a machine type that can attach local SSD disks. If you specify your own machine type or machine series, they should be able to attach local SSD disks, otherwise the job scheduling will fail.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 23.06.0-edge.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">disk</span></code> directive can be used to override the disk requested by Fusion. See the <a class="reference internal" href="#google-batch-process"><span class="std std-ref">Process definition</span></a> section above for examples. Note that local SSD disks must be a multiple of 375 GB in size, otherwise the size will be increased to the next multiple of 375 GB.</p>
</section>
<section id="supported-directives">
<h3>Supported directives<a class="headerlink" href="#supported-directives" title="Permalink to this heading"></a></h3>
<p>The integration with Google Batch is a developer preview feature. Currently, the following Nextflow directives are supported:</p>
<ul class="simple">
<li><p><a class="reference internal" href="process.html#process-accelerator"><span class="std std-ref">accelerator</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-container"><span class="std std-ref">container</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-containeroptions"><span class="std std-ref">containerOptions</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-cpus"><span class="std std-ref">cpus</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-disk"><span class="std std-ref">disk</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-executor"><span class="std std-ref">executor</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-machinetype"><span class="std std-ref">machineType</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-memory"><span class="std std-ref">memory</span></a></p></li>
<li><p><a class="reference internal" href="process.html#process-time"><span class="std std-ref">time</span></a></p></li>
</ul>
</section>
</section>
<section id="cloud-life-sciences">
<span id="google-lifesciences"></span><h2>Cloud Life Sciences<a class="headerlink" href="#cloud-life-sciences" title="Permalink to this heading"></a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 20.01.0-edge.</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In versions of Nextflow prior to <code class="docutils literal notranslate"><span class="pre">21.04.0</span></code>, the following variables must be defined in your system environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">NXF_VER</span><span class="o">=</span><span class="m">20</span>.01.0
<span class="nb">export</span><span class="w"> </span><span class="nv">NXF_MODE</span><span class="o">=</span>google
</pre></div>
</div>
</div>
<p><a class="reference external" href="https://cloud.google.com/life-sciences/">Cloud Life Sciences</a> is a managed computing service that allows the execution of containerized workloads in the Google Cloud Platform infrastructure.</p>
<p>Nextflow provides built-in support for Cloud Life Sciences, allowing the seamless deployment of Nextflow pipelines in the cloud, in which tasks are offloaded to the Cloud Life Sciences service.</p>
<p>Read the <a class="reference internal" href="executor.html#google-lifesciences-executor"><span class="std std-ref">Google Life Sciences executor</span></a> page to learn about the <code class="docutils literal notranslate"><span class="pre">google-lifesciences</span></code> executor in Nextflow.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This API works well for coarse-grained workloads (i.e. long-running jobs). It’s not suggested the use this feature for pipelines spawning many short lived tasks.</p>
</div>
<section id="google-lifesciences-config">
<span id="id1"></span><h3>Configuration<a class="headerlink" href="#google-lifesciences-config" title="Permalink to this heading"></a></h3>
<p>Make sure to have defined in your environment the <code class="docutils literal notranslate"><span class="pre">GOOGLE_APPLICATION_CREDENTIALS</span></code> variable. See the section <a class="reference internal" href="#credentials"><span class="std std-doc">Credentials</span></a> for details.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Make sure to enable the Cloud Life Sciences API beforehand. To learn how to enable it follow <a class="reference external" href="https://cloud.google.com/life-sciences/docs/quickstart">this link</a>.</p>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file in the project root directory. The config must specify the following parameters:</p>
<ul class="simple">
<li><p>Google Life Sciences as Nextflow executor</p></li>
<li><p>The Docker container image(s) for pipeline tasks</p></li>
<li><p>The Google Cloud project ID</p></li>
<li><p>The Google Cloud region or zone where the Compute Engine VMs will be executed.
You need to specify one or the other, <em>not</em> both. Multiple regions or zones can be specified as a comma-separated list, e.g. <code class="docutils literal notranslate"><span class="pre">google.zone</span> <span class="pre">=</span> <span class="pre">'us-central1-f,us-central-1-b'</span></code>.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;google-lifesciences&#39;</span>
<span class="w">    </span><span class="n">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;your/container:latest&#39;</span>
<span class="o">}</span>

<span class="n">google</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">project</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;your-project-id&#39;</span>
<span class="w">    </span><span class="n">zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;europe-west1-b&#39;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Notes:</p>
<ul class="simple">
<li><p>A container image must be specified to execute processes. You can use a different Docker image for each process using one or more <a class="reference internal" href="config.html#config-process-selectors"><span class="std std-ref">Process selectors</span></a>.</p></li>
<li><p>Make sure to specify the project ID, not the project name.</p></li>
<li><p>Make sure to specify a location where Google Life Sciences is available. Refer to the <a class="reference external" href="https://cloud.google.com/life-sciences/docs/concepts/locations">Google Cloud documentation</a> for details.</p></li>
</ul>
<p>Read the <a class="reference internal" href="config.html#config-google"><span class="std std-ref">Google configuration</span></a> section to learn more about advanced configuration options.</p>
</section>
<section id="id2">
<h3>Process definition<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>Processes can be defined as usual and by default the <code class="docutils literal notranslate"><span class="pre">cpus</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code> directives are used to instantiate a custom machine type with the specified compute resources. If <code class="docutils literal notranslate"><span class="pre">memory</span></code> is not specified, 1GB of memory is allocated per cpu. A persistent disk will be created with size corresponding to the <code class="docutils literal notranslate"><span class="pre">disk</span></code> directive. If <code class="docutils literal notranslate"><span class="pre">disk</span></code> is not specified, the instance default is chosen to ensure reasonable I/O performance.</p>
<p>The process <code class="docutils literal notranslate"><span class="pre">machineType</span></code> directive may optionally be used to specify a predefined Google Compute Platform <a class="reference external" href="https://cloud.google.com/compute/docs/machine-types">machine type</a> If specified, this value overrides the <code class="docutils literal notranslate"><span class="pre">cpus</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code> directives. If the <code class="docutils literal notranslate"><span class="pre">cpus</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code> directives are used, the values must comply with the allowed custom machine type <a class="reference external" href="https://cloud.google.com/compute/docs/instances/creating-instance-with-custom-machine-type#specifications">specifications</a> . Extended memory is not directly supported, however high memory or cpu predefined instances may be utilized using the <code class="docutils literal notranslate"><span class="pre">machineType</span></code> directive</p>
<p>Examples:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="n">custom_resources_task</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">cpus</span><span class="w"> </span><span class="mi">8</span>
<span class="w">    </span><span class="n">memory</span><span class="w"> </span><span class="s1">&#39;40 GB&#39;</span>
<span class="w">    </span><span class="n">disk</span><span class="w"> </span><span class="s1">&#39;200 GB&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;Your script here&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>

<span class="n">process</span><span class="w"> </span><span class="n">predefined_resources_task</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">machineType</span><span class="w"> </span><span class="s1">&#39;n1-highmem-8&#39;</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;Your script here&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Pipeline execution<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>The pipeline can be launched either in a local computer or a cloud instance. Pipeline input data can be stored either locally or in a Google Storage bucket.</p>
<p>The pipeline execution must specify a Google Storage bucket where the workflow’s intermediate results are stored using the <code class="docutils literal notranslate"><span class="pre">-work-dir</span></code> command line options. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nextflow<span class="w"> </span>run<span class="w"> </span>&lt;script<span class="w"> </span>or<span class="w"> </span>project<span class="w"> </span>name&gt;<span class="w"> </span>-work-dir<span class="w"> </span>gs://my-bucket/some/path
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Any input data <em>not</em> stored in a Google Storage bucket will be automatically transferred to the pipeline work bucket. Use this feature with caution, being careful to avoid unnecessary data transfers.</p>
</div>
</section>
<section id="preemptible-instances">
<h3>Preemptible instances<a class="headerlink" href="#preemptible-instances" title="Permalink to this heading"></a></h3>
<p>Preemptible instances are supported adding the following setting in the Nextflow config file:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">google</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">lifeSciences</span><span class="o">.</span><span class="na">preemptible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Since this type of virtual machines can be retired by the provider before the job completion, it is advisable to add the following retry strategy to your config file to instruct Nextflow to automatically re-execute a job if the virtual machine was terminated preemptively:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="n">task</span><span class="o">.</span><span class="na">exitStatus</span><span class="o">==</span><span class="mi">14</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;retry&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;terminate&#39;</span><span class="w"> </span><span class="o">}</span>
<span class="w">    </span><span class="n">maxRetries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Preemptible instances have a <a class="reference external" href="https://cloud.google.com/compute/docs/instances/preemptible">runtime limit</a> of 24 hours.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For an exhaustive list of error codes, refer to the official Google Life Sciences <a class="reference external" href="https://cloud.google.com/life-sciences/docs/troubleshooting#error_codes">documentation</a>.</p>
</div>
</section>
<section id="hybrid-execution">
<h3>Hybrid execution<a class="headerlink" href="#hybrid-execution" title="Permalink to this heading"></a></h3>
<p>Nextflow allows the use of multiple executors in the same workflow. This feature enables the deployment of hybrid workloads, in which some jobs are executed in the local computer or local computing cluster, and some jobs are offloaded to Google Life Sciences.</p>
<p>To enable this feature, use one or more <a class="reference internal" href="config.html#config-process-selectors"><span class="std std-ref">Process selectors</span></a> in your Nextflow configuration file to apply the Google Life Sciences executor to the subset of processes that you want to offload. For example:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nl">withLabel:</span><span class="w"> </span><span class="n">bigTask</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;google-lifesciences&#39;</span>
<span class="w">        </span><span class="n">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;my/image:tag&#39;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

<span class="n">google</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">project</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;your-project-id&#39;</span>
<span class="w">    </span><span class="n">zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;europe-west1-b&#39;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Then launch the pipeline with the <code class="docutils literal notranslate"><span class="pre">-bucket-dir</span></code> option to specify a Google Storage path for the jobs computed with Google Life Sciences and, optionally, the <code class="docutils literal notranslate"><span class="pre">-work-dir</span></code> to specify the local storage for the jobs computed locally:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nextflow<span class="w"> </span>run<span class="w"> </span>&lt;script<span class="w"> </span>or<span class="w"> </span>project<span class="w"> </span>name&gt;<span class="w"> </span>-bucket-dir<span class="w"> </span>gs://my-bucket/some/path
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Google Storage path needs to contain at least one sub-directory (e.g. <code class="docutils literal notranslate"><span class="pre">gs://my-bucket/work</span></code> rather than <code class="docutils literal notranslate"><span class="pre">gs://my-bucket</span></code>).</p>
</div>
</section>
<section id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Compute resources in Google Cloud are subject to <a class="reference external" href="https://cloud.google.com/compute/quotas">resource quotas</a>, which may affect your ability to run pipelines at scale. You can request quota increases, and your quotas may automatically increase over time as you use the platform. In particular, GPU quotas are initially set to 0, so you must explicitly request a quota increase in order to use GPUs. You can initially request an increase to 1 GPU at a time, and after one billing cycle you may be able to increase it further.</p></li>
<li><p>Currently, it’s not possible to specify a disk type different from the default one assigned by the service depending on the chosen instance type.</p></li>
</ul>
</section>
<section id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading"></a></h3>
<ul class="simple">
<li><p>Make sure to enable the Compute Engine API, Life Sciences API and Cloud Storage API in the <a class="reference external" href="https://console.cloud.google.com/apis/dashboard">APIs &amp; Services Dashboard</a> page.</p></li>
<li><p>Make sure to have enough compute resources to run your pipeline in your project <a class="reference external" href="https://console.cloud.google.com/iam-admin/quotas">Quotas</a> (i.e. Compute Engine CPUs, Compute Engine Persistent Disk, Compute Engine In-use IP addresses, etc).</p></li>
<li><p>Make sure your security credentials allow you to access any Google Storage bucket where input data and temporary files are stored.</p></li>
<li><p>When a job fails, you can check the <code class="docutils literal notranslate"><span class="pre">google/</span></code> directory in the task work directory (in the bucket storage), which contains useful information about the job execution. To enable the creation of this directory, set <code class="docutils literal notranslate"><span class="pre">google.lifeSciences.debug</span> <span class="pre">=</span> <span class="pre">true</span></code> in the Nextflow config.</p></li>
<li><p>You can enable the optional SSH daemon in the job VM by setting <code class="docutils literal notranslate"><span class="pre">google.lifeSciences.sshDaemon</span> <span class="pre">=</span> <span class="pre">true</span></code> in the Nextflow config.</p></li>
<li><p>Make sure you are choosing a <code class="docutils literal notranslate"><span class="pre">location</span></code> where the <a class="reference external" href="https://cloud.google.com/life-sciences/docs/concepts/locations">Cloud Life Sciences API is available</a>, and a <code class="docutils literal notranslate"><span class="pre">region</span></code> or <code class="docutils literal notranslate"><span class="pre">zone</span></code> where the <a class="reference external" href="https://cloud.google.com/compute/docs/regions-zones/">Compute Engine API is available</a>.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="flux.html" class="btn btn-neutral float-left" title="Flux Framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ignite.html" class="btn btn-neutral float-right" title="Apache Ignite" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Seqera Labs, S.L.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
     
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TNCXSWG"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->


</body>
</html>