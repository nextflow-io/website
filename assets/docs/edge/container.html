<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Containers &mdash; Nextflow 22.07.1-edge documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Conda environments" href="conda.html" />
    <link rel="prev" title="Command line interface (CLI)" href="cli.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Nextflow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Get started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">Basic concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="script.html">Nextflow scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executors</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dsl2.html">DSL 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface (CLI)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Containers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#charliecloud">Charliecloud</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-it-works">How it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#charliecloud-docker-hub">Charliecloud &amp; Docker Hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-containers">Multiple containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-settings">Advanced settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker">Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">How it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Multiple containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Advanced settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#podman">Podman</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">How it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">Multiple containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Advanced settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#shifter">Shifter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#images">Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id15">How it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">Multiple containers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#singularity">Singularity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id18">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id19">Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id20">How it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id21">Multiple containers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#singularity-docker-hub">Singularity &amp; Docker Hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id23">Advanced settings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Conda environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws.html">Amazon Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="amazons3.html">Amazon S3 storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="azure.html">Azure Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="google.html">Google Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="ignite.html">Apache Ignite</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Tracing &amp; visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">Pipeline sharing</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Workflow introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="mail.html">Mail &amp; Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="secrets.html">Secrets</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Nextflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Containers</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/nextflow-io/nextflow/blob/master/docs/container.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="containers">
<span id="container-page"></span><h1>Containers<a class="headerlink" href="#containers" title="Permalink to this headline"></a></h1>
<p>Nextflow supports a variety of container runtimes. Containerization allows you to write
self-contained and truly reproducible computational pipelines, by packaging the binary
dependencies of a script into a standard and portable format that can be executed on any
platform that supports a container runtime. Furthermore, the same pipeline can be transparently
executed with any of the supported container runtimes, depending on which runtimes are available
in the target compute environment.</p>
<section id="charliecloud">
<span id="container-charliecloud"></span><h2>Charliecloud<a class="headerlink" href="#charliecloud" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://hpc.github.io/charliecloud">Charliecloud</a> is an alternative container runtime to Docker, that is better
suited for use in HPC environments. Its main advantage is that it can be used without root privileges,
making use of user namespaces in the Linux kernel. Charliecloud is able to pull from Docker registries.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature requires Nextflow version <code class="docutils literal notranslate"><span class="pre">21.03.0-edge</span></code> or later and Charliecloud <code class="docutils literal notranslate"><span class="pre">v0.22</span></code> or later.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature is experimental. Using it in a production environment is not recommended.</p>
</div>
<section id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h3>
<p>You will need Charliecloud version <code class="docutils literal notranslate"><span class="pre">0.22</span></code> or later installed on your execution environment e.g. your computer or a
distributed cluster, depending on where you want to run your pipeline.</p>
</section>
<section id="how-it-works">
<h3>How it works<a class="headerlink" href="#how-it-works" title="Permalink to this headline"></a></h3>
<p>You won’t need to modify your Nextflow script in order to run it with Charliecloud. Simply specify the docker image from
where the containers are started by using the <code class="docutils literal notranslate"><span class="pre">-with-charliecloud</span></code> command line option. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">script</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">charliecloud</span> <span class="p">[</span><span class="n">container</span><span class="p">]</span>
</pre></div>
</div>
<p>Every time your script launches a process execution, Nextflow will run it into a charliecloud container created by using the
specified container image. In practice Nextflow will automatically wrap your processes and run them by executing the <code class="docutils literal notranslate"><span class="pre">ch-run</span></code>
command with the container you have provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A container image can contain any tool or piece of software you may need to carry out a process execution. Moreover, the
container is run in such a way that the process result files are created in the host file system, thus
it behaves in a completely transparent manner without requiring extra steps or affecting the flow in your pipeline.</p>
</div>
<p>If you want to avoid entering the Container image as a command line parameter, you can define it in the Nextflow configuration
file. For example you can add the following lines in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;/path/to/container&#39;</span>
<span class="n">charliecloud</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If an absolute path is provided, the container needs to be in the Charliecloud flat directory format.
See the section below on compatibility with Docker registries.</p>
</div>
<p>Read the <a class="reference internal" href="config.html#config-page"><span class="std std-ref">Configuration</span></a> page to learn more about the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file and how to use it to configure
your pipeline execution.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Nextflow automatically manages the file system mounts whenever a container is launched depending on the process
input files. However, when a process input is a <em>symbolic link</em>, the linked file <strong>must</strong> be stored
in the same folder where the symlink is located, or a sub-folder of it. Otherwise the process execution will fail because the
launched container won’t be able to access the linked file.</p>
</div>
</section>
<section id="charliecloud-docker-hub">
<h3>Charliecloud &amp; Docker Hub<a class="headerlink" href="#charliecloud-docker-hub" title="Permalink to this headline"></a></h3>
<p>Nextflow is able to transparently pull remote container images stored in any Docker compatible registry and converts
them to the Charliecloud compatible format.</p>
<p>By default when a container name is specified, Nextflow checks if a container with that name exists in the local file
system. If it exists, it’s used to execute the container. If a matching file does not exist,
Nextflow automatically tries to pull an image with the specified name from the Docker Hub.</p>
<p>To pull images from a third party Docker registry simply provide the URL to the image. If no URL is provided,
Docker Hub is assumed. For example this can be used to pull an image from quay.io and convert it automatically
to the Charliecloud container format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;https://quay.io/biocontainers/multiqc:1.3--py35_2&#39;</span>
<span class="n">charliecloud</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>Whereas this would pull from Docker Hub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;nextflow/examples:latest&#39;</span>
<span class="n">charliecloud</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
</section>
<section id="multiple-containers">
<h3>Multiple containers<a class="headerlink" href="#multiple-containers" title="Permalink to this headline"></a></h3>
<p>It is possible to specify a different container for each process definition in your pipeline script. For example,
let’s suppose you have two processes named <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code>. You can specify two different containers
in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">foo</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_1&#39;</span>
    <span class="p">}</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">bar</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_2&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">charliecloud</span> <span class="p">{</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read the <a class="reference internal" href="config.html#config-process"><span class="std std-ref">Process scope</span></a> section to learn more about processes configuration.</p>
</section>
<section id="advanced-settings">
<h3>Advanced settings<a class="headerlink" href="#advanced-settings" title="Permalink to this headline"></a></h3>
<p>Charliecloud advanced configuration settings are described in <a class="reference internal" href="config.html#config-charliecloud"><span class="std std-ref">Scope charliecloud</span></a> section in the Nextflow
configuration page.</p>
</section>
</section>
<section id="docker">
<span id="container-docker"></span><h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="http://www.docker.io">Docker</a> is the industry standard container runtime.</p>
<section id="id3">
<h3>Prerequisites<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h3>
<p>You will need Docker installed on your execution environment e.g. your computer or a distributed cluster, depending
on where you want to run your pipeline.</p>
<p>If you are running Docker on Mac OSX make sure you are mounting your local <code class="docutils literal notranslate"><span class="pre">/Users</span></code> directory into the Docker VM as
explained in this excellent tutorial: <a class="reference external" href="http://viget.com/extend/how-to-use-docker-on-os-x-the-missing-guide">How to use Docker on OSX</a>.</p>
</section>
<section id="id4">
<h3>How it works<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h3>
<p>You won’t need to modify your Nextflow script in order to run it with Docker. Simply specify the Docker image from
where the containers are started by using the <code class="docutils literal notranslate"><span class="pre">-with-docker</span></code> command line option. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">script</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">docker</span> <span class="p">[</span><span class="n">docker</span> <span class="n">image</span><span class="p">]</span>
</pre></div>
</div>
<p>Every time your script launches a process execution, Nextflow will run it into a Docker container created by using the
specified image. In practice Nextflow will automatically wrap your processes and run them by executing the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>
command with the image you have provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A Docker image can contain any tool or piece of software you may need to carry out a process execution. Moreover, the
container is run in such a way that the process result files are created in the host file system, thus
it behaves in a completely transparent manner without requiring extra steps or affecting the flow in your pipeline.</p>
</div>
<p>If you want to avoid entering the Docker image as a command line parameter, you can define it in the Nextflow configuration
file. For example you can add the following lines in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;nextflow/examples:latest&#39;</span>
<span class="n">docker</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>In the above example replace <code class="docutils literal notranslate"><span class="pre">nextflow/examples:latest</span></code> with any Docker image of your choice.</p>
<p>Read the <a class="reference internal" href="config.html#config-page"><span class="std std-ref">Configuration</span></a> page to learn more about the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file and how to use it to configure
your pipeline execution.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Nextflow automatically manages the file system mounts whenever a container is launched depending on the process
input files. However, when a process input is a <em>symbolic link</em>, the linked file <strong>must</strong> be stored
in the same folder where the symlink is located, or a sub-folder of it. Otherwise the process execution will fail because the
launched container won’t be able to access the linked file.</p>
</div>
</section>
<section id="id5">
<h3>Multiple containers<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<p>It is possible to specify a different Docker image for each process definition in your pipeline script. Let’s
suppose you have two processes named <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code>. You can specify two different Docker images for them
in the Nextflow script as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="n">container</span> <span class="s1">&#39;image_name_1&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  do this</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>

<span class="n">process</span> <span class="n">bar</span> <span class="p">{</span>
  <span class="n">container</span> <span class="s1">&#39;image_name_2&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  do that</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Alternatively, the same containers definitions can be provided by using the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">foo</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_1&#39;</span>
    <span class="p">}</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">bar</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_2&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">docker</span> <span class="p">{</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read the <a class="reference internal" href="config.html#config-process"><span class="std std-ref">Process scope</span></a> section to learn more about processes configuration.</p>
</section>
<section id="id6">
<h3>Advanced settings<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h3>
<p>Docker advanced configuration settings are described in <a class="reference internal" href="config.html#config-docker"><span class="std std-ref">Scope docker</span></a> section in the Nextflow configuration page.</p>
</section>
</section>
<section id="podman">
<span id="container-podman"></span><h2>Podman<a class="headerlink" href="#podman" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="http://www.podman.io">Podman</a> is a drop-in replacement for Docker that can run containers with or without root privileges.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature requires Nextflow version <code class="docutils literal notranslate"><span class="pre">20.01.0</span></code> or later.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature is experimental. Using it in a production environment is not recommended.</p>
</div>
<section id="id8">
<h3>Prerequisites<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<p>You will need Podman installed on your execution environment e.g. your computer or a distributed cluster, depending
on where you want to run your pipeline. Running in rootless mode requires appropriate OS configuration. Due to current
Podman limits using cpuset for cpus and memory such is only possible using sudo.</p>
</section>
<section id="id9">
<h3>How it works<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h3>
<p>You won’t need to modify your Nextflow script in order to run it with Podman. Simply specify the Podman image from
where the containers are started by using the <code class="docutils literal notranslate"><span class="pre">-with-podman</span></code> command line option. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">script</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">podman</span> <span class="p">[</span><span class="n">OCI</span> <span class="n">container</span> <span class="n">image</span><span class="p">]</span>
</pre></div>
</div>
<p>Every time your script launches a process execution, Nextflow will run it into a Podman container created by using the
specified image. In practice Nextflow will automatically wrap your processes and run them by executing the <code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">run</span></code>
command with the image you have provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An OCI container image can contain any tool or piece of software you may need to carry out a process execution. Moreover, the
container is run in such a way that the process result files are created in the host file system, thus
it behaves in a completely transparent manner without requiring extra steps or affecting the flow in your pipeline.</p>
</div>
<p>If you want to avoid entering the Podman image as a command line parameter, you can define it in the Nextflow configuration
file. For example you can add the following lines in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;nextflow/examples:latest&#39;</span>
<span class="n">podman</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>In the above example replace <code class="docutils literal notranslate"><span class="pre">nextflow/examples:latest</span></code> with any Podman image of your choice.</p>
<p>Read the <a class="reference internal" href="config.html#config-page"><span class="std std-ref">Configuration</span></a> page to learn more about the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file and how to use it to configure
your pipeline execution.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Nextflow automatically manages the file system mounts whenever a container is launched depending on the process
input files. However, when a process input is a <em>symbolic link</em>, the linked file <strong>must</strong> be stored
in the same folder where the symlink is located, or a sub-folder of it. Otherwise the process execution will fail because the
launched container won’t be able to access the linked file.</p>
</div>
</section>
<section id="id10">
<h3>Multiple containers<a class="headerlink" href="#id10" title="Permalink to this headline"></a></h3>
<p>It is possible to specify a different container image for each process definition in your pipeline script. Let’s
suppose you have two processes named <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code>. You can specify two different container images for them
in the Nextflow script as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="n">foo</span> <span class="p">{</span>
  <span class="n">container</span> <span class="s1">&#39;image_name_1&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  do this</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>

<span class="n">process</span> <span class="n">bar</span> <span class="p">{</span>
  <span class="n">container</span> <span class="s1">&#39;image_name_2&#39;</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  do that</span>
<span class="sd">  &#39;&#39;&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Alternatively, the same containers definitions can be provided by using the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">foo</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_1&#39;</span>
    <span class="p">}</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">bar</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_2&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">podman</span> <span class="p">{</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read the <a class="reference internal" href="config.html#config-process"><span class="std std-ref">Process scope</span></a> section to learn more about processes configuration.</p>
</section>
<section id="id11">
<h3>Advanced settings<a class="headerlink" href="#id11" title="Permalink to this headline"></a></h3>
<p>Podman advanced configuration settings are described in <a class="reference internal" href="config.html#config-podman"><span class="std std-ref">Scope podman</span></a> section in the Nextflow configuration page.</p>
</section>
</section>
<section id="shifter">
<span id="container-shifter"></span><h2>Shifter<a class="headerlink" href="#shifter" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://docs.nersc.gov/programming/shifter/overview/">Shifter</a> is an alternative container runtime to
Docker. Shifter works by converting Docker images to a common format that can then be
distributed and launched on HPC systems. The user interface to Shifter enables a user to select an image
from <a class="reference external" href="https://hub.docker.com/">Docker Hub</a> and then submit jobs which run entirely within the container.</p>
<section id="id13">
<h3>Prerequisites<a class="headerlink" href="#id13" title="Permalink to this headline"></a></h3>
<p>You need Shifter and Shifter image gateway installed in your execution environment, i.e: your personal computed or the
entry node of a distributed cluster. In the case of the distributed cluster case, you should have Shifter installed on
all of the compute nodes and the <code class="docutils literal notranslate"><span class="pre">shifterimg</span></code> command should also be available and Shifter properly setup to access the
Image gateway, for more information see the <a class="reference external" href="https://github.com/NERSC/shifter/tree/master/doc">official documentation</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature requires Shifter version 18.03 (or later) and Nextflow 19.10.0 (or later).</p>
</div>
</section>
<section id="images">
<h3>Images<a class="headerlink" href="#images" title="Permalink to this headline"></a></h3>
<p>Shifter converts a docker image to squashfs layers which are distributed and launched in the cluster. For more information on
how to build Shifter images see the <a class="reference external" href="https://docs.nersc.gov/programming/shifter/how-to-use/#building-shifter-images">official documentation</a>.</p>
</section>
<section id="id15">
<h3>How it works<a class="headerlink" href="#id15" title="Permalink to this headline"></a></h3>
<p>The integration for Shifter, at this time, requires you to set up the following parameters in your config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;dockerhub_user/image_name:image_tag&quot;</span>
<span class="n">shifter</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>and it will always try to search the Docker Hub registry for the images.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if you do not specify an image tag, the <code class="docutils literal notranslate"><span class="pre">latest</span></code> tag will be fetched by default.</p>
</div>
</section>
<section id="id16">
<h3>Multiple containers<a class="headerlink" href="#id16" title="Permalink to this headline"></a></h3>
<p>It is possible to specify a different Shifter image for each process definition in your pipeline script. For example,
let’s suppose you have two processes named <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code>. You can specify two different Shifter images
specifying them in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">foo</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_1&#39;</span>
    <span class="p">}</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">bar</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_2&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">shifter</span> <span class="p">{</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read the <a class="reference internal" href="config.html#config-process"><span class="std std-ref">Process scope</span></a> section to learn more about processes configuration.</p>
</section>
</section>
<section id="singularity">
<span id="container-singularity"></span><h2>Singularity<a class="headerlink" href="#singularity" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="http://singularity.lbl.gov/">Singularity</a> is an alternative container runtime to Docker. The main advantages
of Singularity are that it can be used without root privileges and it doesn’t require a separate daemon process.
These, along with other features such as support for autofs mounts, makes Singularity
better suited to the requirements of HPC workloads. Singularity is able to use existing Docker images and can pull from Docker
registries.</p>
<section id="id18">
<h3>Prerequisites<a class="headerlink" href="#id18" title="Permalink to this headline"></a></h3>
<p>You will need Singularity installed on your execution environment e.g. your computer or a distributed cluster, depending
on where you want to run your pipeline.</p>
</section>
<section id="id19">
<h3>Images<a class="headerlink" href="#id19" title="Permalink to this headline"></a></h3>
<p>Singularity makes use of a container image file, which physically contains the container. Refer to the <a class="reference external" href="https://www.sylabs.io/docs/">Singularity
documentation</a> to learn how create Singularity images.</p>
<p>Singularity allows paths that do not currently exist within the container to be created
and mounted dynamically by specifying them on the command line. However this feature is only supported on hosts
that support the <a class="reference external" href="https://en.wikipedia.org/wiki/OverlayFS">Overlay file system</a> and is not enabled by default.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nextflow expects that data paths are defined system wide, and your Singularity images need to be created having the
mount paths defined in the container file system.</p>
</div>
<p>If your Singularity installation support the <cite>user bind control</cite> feature,
enable the Nextflow support for that by defining the <code class="docutils literal notranslate"><span class="pre">singularity.autoMounts</span> <span class="pre">=</span> <span class="pre">true</span></code> setting in the Nextflow
configuration file.</p>
</section>
<section id="id20">
<h3>How it works<a class="headerlink" href="#id20" title="Permalink to this headline"></a></h3>
<p>The integration for Singularity follows the same execution model implemented for Docker. You won’t need to modify your
Nextflow script in order to run it with Singularity. Simply specify the Singularity image
file from where the containers are started by using the <code class="docutils literal notranslate"><span class="pre">-with-singularity</span></code> command line option. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">&lt;</span><span class="n">your</span> <span class="n">script</span><span class="o">&gt;</span> <span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">singularity</span> <span class="p">[</span><span class="n">singularity</span> <span class="n">image</span> <span class="n">file</span><span class="p">]</span>
</pre></div>
</div>
<p>Every time your script launches a process execution, Nextflow will run it into a Singularity container created by using the
specified image. In practice Nextflow will automatically wrap your processes and launch them by running the
<code class="docutils literal notranslate"><span class="pre">singularity</span> <span class="pre">exec</span></code> command with the image you have provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A Singularity image can contain any tool or piece of software you may need to carry out a process execution.
Moreover, the container is run in such a way that the process result files are created in the host file system, thus
it behaves in a completely transparent manner without requiring extra steps or affecting the flow in your pipeline.</p>
</div>
<p>If you want to avoid entering the Singularity image as a command line parameter, you can define it in the Nextflow
configuration file. For example you can add the following lines in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;/path/to/singularity.img&#39;</span>
<span class="n">singularity</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>In the above example replace <code class="docutils literal notranslate"><span class="pre">/path/to/singularity.img</span></code> with any Singularity image of your choice.</p>
<p>Read the <a class="reference internal" href="config.html#config-page"><span class="std std-ref">Configuration</span></a> page to learn more about the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file and how to use it to configure
your pipeline execution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike Docker, Nextflow does not automatically mount host paths in the container when using Singularity.
It expects that the paths are configure and mounted system wide by the Singularity runtime. If your Singularity installation
allows user defined bind points, read the <a class="reference internal" href="config.html#config-singularity"><span class="std std-ref">Singularity configuration</span></a> section to learn
how to enable Nextflow auto mounts.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When a process input is a <em>symbolic link</em> file, make sure the linked file is stored in a host folder that is
accessible from a bind path defined in your Singularity installation. Otherwise the process execution will fail
because the launched container won’t be able to access the linked file.</p>
</div>
</section>
<section id="id21">
<h3>Multiple containers<a class="headerlink" href="#id21" title="Permalink to this headline"></a></h3>
<p>It is possible to specify a different Singularity image for each process definition in your pipeline script. For example,
let’s suppose you have two processes named <code class="docutils literal notranslate"><span class="pre">foo</span></code> and <code class="docutils literal notranslate"><span class="pre">bar</span></code>. You can specify two different Singularity images
specifing them in the <code class="docutils literal notranslate"><span class="pre">nextflow.config</span></code> file as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="p">{</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">foo</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_1&#39;</span>
    <span class="p">}</span>
    <span class="n">withName</span><span class="p">:</span><span class="n">bar</span> <span class="p">{</span>
        <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;image_name_2&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">singularity</span> <span class="p">{</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Read the <a class="reference internal" href="config.html#config-process"><span class="std std-ref">Process scope</span></a> section to learn more about processes configuration.</p>
</section>
<section id="singularity-docker-hub">
<h3>Singularity &amp; Docker Hub<a class="headerlink" href="#singularity-docker-hub" title="Permalink to this headline"></a></h3>
<p>Nextflow is able to transparently pull remote container images stored in the <a class="reference external" href="https://singularity-hub.org/">Singularity-Hub</a>,
<a class="reference external" href="https://cloud.sylabs.io/library/">Singularity Library</a>, or any Docker compatible registry.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature requires Singularity 2.3.x or higher</p>
</div>
<p>By default when a container name is specified, Nextflow checks if an image file with that name exists in the local file
system. If that image file exists, it’s used to execute the container. If a matching file does not exist,
Nextflow automatically tries to pull an image with the specified name from the Docker Hub.</p>
<p>If you want Nextflow to check only for local file images, prefix the container name with the <code class="docutils literal notranslate"><span class="pre">file://</span></code> pseudo-protocol.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;file:///path/to/singularity.img&#39;</span>
<span class="n">singularity</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use three <code class="docutils literal notranslate"><span class="pre">/</span></code> slashes to specify an <strong>absolute</strong> file path, otherwise the path will be interpreted as
relative to the workflow launch directory.</p>
</div>
<p>To pull images from the Singularity Hub or a third party Docker registry simply prefix the image name
with the <code class="docutils literal notranslate"><span class="pre">shub://</span></code>, <code class="docutils literal notranslate"><span class="pre">docker://</span></code> or <code class="docutils literal notranslate"><span class="pre">docker-daemon://</span></code> pseudo-protocol as required by the Singularity tool. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;docker://quay.io/biocontainers/multiqc:1.3--py35_2&#39;</span>
<span class="n">singularity</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>You do not need to specify <code class="docutils literal notranslate"><span class="pre">docker://</span></code> to pull from a Docker repository.
Nextflow will automatically prepend it to your image name when Singularity is enabled.
Additionally, the Docker engine will not work with containers specified as <code class="docutils literal notranslate"><span class="pre">docker://</span></code>.</p>
<p>Nextflow version 18.10 introduced support for the <a class="reference external" href="https://cloud.sylabs.io/library/">Singularity Library</a> repository. This feature also requires Singularity 3.0:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">process</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;library://library/default/alpine:3.8&#39;</span>
</pre></div>
</div>
<p>The pseudo-protocol allows you to import Singularity using a local Docker installation instead of downloading
the container image from the Docker registry. It requires Nextflow 19.04.0 or later and Singularity 3.0.3 or later.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature requires the <code class="docutils literal notranslate"><span class="pre">singularity</span></code> tool to be installed
where the workflow execution is launched (as opposed to the compute nodes).</p>
</div>
<p>Nextflow caches those images in the <code class="docutils literal notranslate"><span class="pre">singularity</span></code> directory in the pipeline work directory by default. However it is
suggested to provide a centralised cache directory by using either the <code class="docutils literal notranslate"><span class="pre">NXF_SINGULARITY_CACHEDIR</span></code> environment variable
or the <code class="docutils literal notranslate"><span class="pre">singularity.cacheDir</span></code> setting in the Nextflow config file.</p>
<p>As of version <code class="docutils literal notranslate"><span class="pre">21.09.0-edge</span></code>, when looking for a Singularity image file, Nextflow first checks the <em>library</em> directory,
and if the image file is not found, the <em>cache</em> directory is used as usual. The library directory can be defined either using
the <code class="docutils literal notranslate"><span class="pre">NXF_SINGULARITY_LIBRARYDIR</span></code> environment variable or the <code class="docutils literal notranslate"><span class="pre">singularity.libraryDir</span></code> configuration setting (the
latter overrides the former).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When using a compute cluster, the Singularity cache directory must reside in a shared filesystem accessible to all compute nodes.</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>When pulling Docker images, Singularity may be unable to determine the container size if the image was
stored using an old Docker format, resulting in a pipeline execution error. See the Singularity documentation for details.</p>
</div>
</section>
<section id="id23">
<h3>Advanced settings<a class="headerlink" href="#id23" title="Permalink to this headline"></a></h3>
<p>Singularity advanced configuration settings are described in <a class="reference internal" href="config.html#config-singularity"><span class="std std-ref">Scope singularity</span></a> section in the Nextflow
configuration page.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cli.html" class="btn btn-neutral float-left" title="Command line interface (CLI)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="conda.html" class="btn btn-neutral float-right" title="Conda environments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Seqera Labs. 2013-2019, Centre for Genomic Regulation (CRG)..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-364526-10"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-364526-10', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>